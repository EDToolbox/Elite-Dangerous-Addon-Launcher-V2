<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

  <Package Name="Elite Dangerous Addon Launcher V2"
           Manufacturer="EDToolbox"
           Version="!(bind.FileVersion.MainExecutable)"
           UpgradeCode="A1B2C3D4-E5F6-4A5B-8C9D-0E1F2A3B4C5D">

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <!-- Installation directory -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="Elite Dangerous Addon Launcher V2" />
    </StandardDirectory>

    <!-- Start Menu -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Elite Dangerous Addon Launcher V2" />
    </StandardDirectory>

    <!-- Desktop -->
    <StandardDirectory Id="DesktopFolder" />

    <!-- Main executable component with shortcuts -->
    <Component Id="MainExecutable" Directory="INSTALLFOLDER">
      <File Id="MainExeFile"
            Source="$(var.PublishDir)\Elite Dangerous Addon Launcher V2.exe"
            KeyPath="yes">
        <Shortcut Id="StartMenuShortcut"
                  Directory="ApplicationProgramsFolder"
                  Name="Elite Dangerous Addon Launcher V2"
                  Description="Launch Elite Dangerous addons"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="ProductIcon.ico" />
        <Shortcut Id="DesktopShortcut"
                  Directory="DesktopFolder"
                  Name="Elite Dangerous Addon Launcher V2"
                  Description="Launch Elite Dangerous addons"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="ProductIcon.ico" />
      </File>
    </Component>

    <!-- Cleanup shortcuts on uninstall -->
    <Component Id="ApplicationShortcutCleanup" Directory="ApplicationProgramsFolder">
      <RemoveFolder Id="CleanupShortcuts" On="uninstall" />
      <RegistryValue Root="HKCU"
                     Key="Software\EDToolbox\Elite Dangerous Addon Launcher V2"
                     Name="installed"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>

    <!-- Application icon -->
    <Icon Id="ProductIcon.ico" SourceFile="elite-dangerous-icon.ico" />
    <Property Id="ARPPRODUCTICON" Value="ProductIcon.ico" />

    <!-- License -->
    <WixVariable Id="WixUILicenseRtf" Value="installer\License.rtf" />

    <!-- UI -->
    <ui:WixUI Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Feature -->
    <Feature Id="Complete" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentGroupRef Id="PublishedFiles" />
      <ComponentRef Id="ApplicationShortcutCleanup" />
    </Feature>

  </Package>
</Wix>
